
@{
    Layout = "_Layout_Your_Courses";
}

@model Dfc.CourseDirectory.Web.ViewModels.Apprenticeships.ApprenticeshipDetailViewModel

<form class="govuk-!-margin-bottom-9" id="ApprenticeshipDetailsForm" asp-controller="Apprenticeships" asp-action="ApprenticeShipDetails" method="post">
    <a asp-controller="Apprenticeships" asp-action="Index" class="govuk-back-link">Back</a>
    <div class="cd-dashboard govuk-grid-row govuk-body ">

        <div class="govuk-grid-column-two-thirds">
            <h1 class="govuk-heading-xl">
                Add apprenticeship training details

            </h1>
            <div id="errorsummary" class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="error-summary" style="display: none;">
                <h2 class="govuk-error-summary__title" id="error-summary-title">
                    There is a problem
                </h2>
                <div class="govuk-error-summary__body">
                    <ul class="govuk-list govuk-error-summary__list"></ul>
                </div>
            </div>
            @Html.HiddenFor(x => x.Id)
            @Html.HiddenFor(x => x.StandardCode)
            @Html.HiddenFor(x => x.FrameworkCode)
            @Html.HiddenFor(x => x.ApprenticeshipTitle)
            @Html.HiddenFor(x => x.ApprenticeshipType)
            @Html.HiddenFor(x => x.ApprenticeshipPreviousPage)




            @{ var regex = @"^[a-zA-Z0-9 /\n/\r/\¬\!\£\$\%\^\&\*\(\)_\+\-\=\{\}\[\]\;\:\@\'\#\~\,\<\>\.\?\/\|\`" + "\"" + "\\\\]+$"; }
            @{ var emailRegEx = @"^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$"; }
            @{ var telephoneRegEx = @"^(((\+44)? ?(\(0\))? ?)|(0))( ?[0-9]{3,4}){3}?$";}
            @{ var websiteRegEx = @"^([-a-zA-Z0-9]{2,256}\.)+[a-z]{2,10}(\/.*)?";}

            <div class="govuk-character-count">
                <div class="govuk-form-group">

                    <span id="infoRequired" class="" style="display: none"
                          val-required-message="Enter Apprenticeship information for employers">Enter Apprenticeship information for employers</span>
                    <span id="infoMax" class="" style="display: none"
                          val-max-length="750"
                          val-max-length-message="Apprenticeship information for employers should be no more than 750 characters">Apprenticeship information for employers should be no more than 750 characters</span>
                    <span id="infoInvalid" class="" style="display: none"
                          val-regex="@regex"
                          val-regex-message="Apprenticeship information for employers should only have letters, numbers, spaces and commonly-used punctuation">Apprenticeship information for employers should only have letters, numbers, spaces and commonly-used punctuation</span>
                    <label class="govuk-label" for="word-count">
                        Apprenticeship information for employers
                    </label>
                    <span id="more-detail-hint" class="govuk-hint">
                        Give information for employers about how you deliver this specific apprenticeship training. For useful advice on how to fill out this section go to the <a href="https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/746087/course_directory_provider_portal_user_guide_v7.pdf" target="_blank">guidance</a>
                    </span>
                    <textarea class="govuk-textarea" asp-for="@Model.Information" rows="5" id="info"></textarea>
                </div>
            </div>

            <div id="WebsiteContainer" class="govuk-form-group">
                <label id="govuk-label-Website" class="govuk-label">
                    Website
                </label>
                <span class="govuk-hint">
                    Your web page for this apprenticeship. Include http://
                </span>
                <input class="govuk-input" asp-for="@Model.Website" type="text" aria-describedby=""
                       val-max-length="255"
                       val-max-length-message="Apprenticeship web page should be no more than 255 characters"
                       val-regex="@websiteRegEx"
                       val-regex-message="Apprenticeship web page should only have letters, numbers, spaces and commonly-used punctuation">
            </div>
            <h2 class="">Contact details</h2>

            <div id="ContactUsContainer" class="govuk-form-group">
                <span id="more-detail-hint" class="govuk-hint">Who can employers contact about this apprenticeship training?</span>

                <label id="govuk-label-Email" class="govuk-label">
                    Email
                </label>
                <input class="govuk-input" asp-for="@Model.Email" type="text" aria-describedby=""
                       val-required-message="Enter email"
                       val-max-length="255"
                       val-max-length-message="Email should be no more than 255 characters"
                       val-regex="@emailRegEx"
                       val-regex-message="Enter a valid emaild">


            </div>
            <div id="TelephoneContainer" class="govuk-form-group">
                <label id="govuk-label-Telephone" class="govuk-label">
                    Telephone
                </label>

                <input class="govuk-input govuk-!-width-one-half" asp-for="@Model.Telephone" type="text" aria-describedby=""
                       val-required-message="Enter telephone"
                       val-min-length="11"
                       val-min-length-message="Telephone should be minimum 11 characters"
                       val-max-length="30"
                       val-max-length-message="Telephone should be no more than 30 characters"
                       val-regex="@telephoneRegEx"
                       val-regex-message="Enter a valid telephone number">
            </div>
            <div id="ContactUsContainer" class="govuk-form-group">
                <label id="govuk-label-Cost" class="govuk-label">
                    Contact us page
                </label>
                <span id="more-detail-hint" class="govuk-hint">You can also add the url of any 'Contact us' page you have on your website</span>

                <input class="govuk-input" asp-for="@Model.ContactUsIUrl" type="text" aria-describedby=""
                       val-max-length="255"
                       val-max-length-message="Contact us page should be no more than 255 characters"
                       val-regex="@websiteRegEx"
                       val-regex-message="Contact us page should only have letters, numbers, spaces and commonly-used punctuation">

            </div>
            <div class="govuk-form-group govuk-!-margin-bottom-6">


            </div>



            <button type="submit" class="govuk-button" id="continue" value="continue">
                Continue
            </button>

        </div>
    </div>
    </form>












  


    <script>
    (function($) {
        $(function () {

                        $(document).ready(function () {

                 tinymce.init({
           selector: '#info',
           plugins: "wordcount advlist lists autoresize",
  toolbar: "wordcount",
           menubar: false,
    statusbar: true,
                     resize: false,
                    min_height:450,
                     width: '57em',
  height: '75%',
  autoresize_min_height: 600,
  autoresize_max_height: 800,
            toolbar: 'formatselect | bold | numlist bullist | removeformat ',
                 }).then(function (editors) {

                     $(".tox-statusbar__path").hide();
                      $(".tox-statusbar__branding").hide();

                    $(".tox-statusbar__wordcount").trigger( "click" );
});

                        });

                            var $continueButton = $("#continue");
            var validStates = [];

             var $maxInfo = $("#infoMax");
            var $invalidInfo = $("#infoInvalid");
              var $requiredInfo = $("#infoRequired");

            var $errorSummary = $("#errorsummary").govUkErrorSummary();
            var $email = $("#@nameof(Model.Email)").govUkInput();
            var $website = $("#@nameof(Model.Website)").govUkInput();
             var $contactUs = $("#@nameof(Model.ContactUsIUrl)").govUkInput();
             var $telephone = $("#@nameof(Model.Telephone)").govUkInput();

              $website.on("blur", function () {
                var trimmed = $website.val().trim().toLowerCase();
                $website.val(trimmed);
                if ($website.val() !== "") {


                    if ($website.val().indexOf("http") >= 0 || $website.val().indexOf("https")>=0) {

                }
                else {
                    $website.val("http://" + trimmed);
                    }
                }
              });

              $contactUs.on("blur", function () {
                var trimmed = $contactUs.val().trim().toLowerCase();
                $contactUs.val(trimmed);
                if ($contactUs.val() !== "") {


                    if ($contactUs.val().indexOf("http") >= 0 || $contactUs.val().indexOf("https")>=0) {

                }
                else {
                    $contactUs.val("http://" + trimmed);
                    }
                }
            });

            function isAllValid(currentValue) {
                return currentValue === true;
            }

            function validate() {

                validStates = [];

                  $invalidInfo.removeClass("govuk-error-message");
                    $invalidInfo.hide();
                    $maxInfo.removeClass("govuk-error-message");
                    $maxInfo.hide();
                      $requiredInfo.removeClass("govuk-error-message");
                $requiredInfo.hide();

                $email.val($email.val().trim());
                $website.val($website.val().trim());
                $contactUs.val($contactUs.val().trim());
                          $telephone.val($telephone.val().trim());

                $errorSummary.govUkErrorSummary("removeAll");
                $email.govUkInput("validState");
                $telephone.govUkInput("validState");

                if (!$.requiredValidate(tinymce.get('info').getBody().innerText.trim())) {

                    $requiredInfo.addClass("govuk-error-message");
                    $requiredInfo.show();

                    $(".tox-editor-container").addClass("text-error");
                    $(".tox-statusbar").addClass("status-error");

                    $(".tox-editor-container").closest(".govuk-form-group").addClass("govuk-form-group--error");

                    var element = $requiredInfo;
                     var $anchor = document.createElement("a");
                $anchor.href =  "#infoRequired";
                $anchor.innerHTML = element.text();
                $anchor.id = "error-hash-link-" + "a" + "-" + 1;

                     $errorSummary.govUkErrorSummary("add", $anchor);
                    $errorSummary.govUkErrorSummary("show");


                    validStates.push(false);
                } else if (
                    !$.regexValidate({ regex: $invalidInfo.attr("val-regex") }, tinymce.get('info').getBody().innerText.trim())) {
                        $invalidInfo.addClass("govuk-error-message");
                        $invalidInfo.show();

                        $(".tox-editor-container").addClass("text-error");
                        $(".tox-statusbar").addClass("status-error");

                        $(".tox-editor-container").closest(".govuk-form-group").addClass("govuk-form-group--error");

                        var element = $invalidInfo;
                     var $anchor = document.createElement("a");
                $anchor.href =  "#infoInvalid";
                $anchor.innerHTML = element.text();
                $anchor.id = "error-hash-link-" + "b" + "-" + 1;

                     $errorSummary.govUkErrorSummary("add", $anchor);
                    $errorSummary.govUkErrorSummary("show");

                        validStates.push(false);
                } else if (
                    !$.maxLengthValidate({ max: "750" }, tinymce.get('info').getBody().innerText)) {

                    $maxInfo.addClass("govuk-error-message");
                    $maxInfo.show();

                    $(".tox-editor-container").addClass("text-error");
                    $(".tox-statusbar").addClass("status-error");

                    $(".tox-editor-container").closest(".govuk-form-group").addClass("govuk-form-group--error");

                     var element = $maxInfo;
                     var $anchor = document.createElement("a");
                $anchor.href =  "#infoMax";
                $anchor.innerHTML = element.text();
                $anchor.id = "error-hash-link-" + "c" + "-" + 1;

                     $errorSummary.govUkErrorSummary("add", $anchor);
                    $errorSummary.govUkErrorSummary("show");

                    validStates.push(false);
                } else {

                    $invalidInfo.removeClass("govuk-error-message");
                    $invalidInfo.hide();
                    $maxInfo.removeClass("govuk-error-message");
                    $maxInfo.hide();
                      $requiredInfo.removeClass("govuk-error-message");
                    $requiredInfo.hide();

                    $(".tox-editor-container").removeClass("text-error");
                    $(".tox-statusbar").removeClass("status-error");

                    $(".tox-editor-container").closest(".govuk-form-group").removeClass("govuk-form-group--error");

                    validStates.push(true);
                }


                // email
                if (!$.requiredValidate($email.val())) {
                    $email.govUkInput("invalidState", $email.attr("val-required-message"));
                     var emailErrorHashLinks = $email.govUkInput("getErrorHashLinks");
                    $errorSummary.govUkErrorSummary("add", emailErrorHashLinks);
                    $errorSummary.govUkErrorSummary("show");
                    validStates.push(false);
                } else if (
                    !$.regexValidate({ regex: $email.attr("val-regex") }, $email.val())) {
                    $email.govUkInput("invalidState", $email.attr("val-regex-message"));
                    var emailErrorHashLinks = $email.govUkInput("getErrorHashLinks");
                    $errorSummary.govUkErrorSummary("add", emailErrorHashLinks);
                    $errorSummary.govUkErrorSummary("show");
                    validStates.push(false);
                } else if (
                    !$.maxLengthValidate({ max: $email.attr("val-max-length") }, $email.val())) {
                    $email.govUkInput("invalidState", $email.attr("val-max-length-message"));
                    var emailErrorHashLinks = $email.govUkInput("getErrorHashLinks");
                    $errorSummary.govUkErrorSummary("add", emailErrorHashLinks);
                    $errorSummary.govUkErrorSummary("show");
                    validStates.push(false);
                } else {
                    $email.govUkInput("validState");
                    $errorSummary.govUkErrorSummary("removeErrorHashLinksFor", $email[0].id);
                    $errorSummary.govUkErrorSummary("hideIfEmpty")
                    validStates.push(true);
                }


                  var enteredWebsite = $website.val();
                var websiteToValidate = "";
                if ($website.val().indexOf("http")>=0) {
                    websiteToValidate = enteredWebsite.substring(enteredWebsite.indexOf("//") + 2, enteredWebsite.length);
                }
                else {
                    websiteToValidate = $website.val();
                }

                 // website (
                 if (!$.regexValidate({ regex: $website.attr("val-regex") }, websiteToValidate)) {
                    $website.govUkInput("invalidState", $website.attr("val-regex-message"));
                    var websiteErrorHashLinks = $website.govUkInput("getErrorHashLinks");
                    $errorSummary.govUkErrorSummary("add", websiteErrorHashLinks);
                    $errorSummary.govUkErrorSummary("show");
                    validStates.push(false);
                } else if (
                    !$.maxLengthValidate({ max: $website.attr("val-max-length") }, websiteToValidate)) {
                    $website.govUkInput("invalidState", $website.attr("val-max-length-message"));
                    var websiteErrorHashLinks = $website.govUkInput("getErrorHashLinks");
                    $errorSummary.govUkErrorSummary("add", websiteErrorHashLinks);
                    $errorSummary.govUkErrorSummary("show");
                    validStates.push(false);
                } else {
                    $website.govUkInput("validState");
                    $errorSummary.govUkErrorSummary("removeErrorHashLinksFor", $website[0].id);
                    $errorSummary.govUkErrorSummary("hideIfEmpty")
                    validStates.push(true);
                }

                  var enteredContactUs = $contactUs.val();
                var contactUsToValidate = "";
                if ($contactUs.val().indexOf("http")>=0) {
                    contactUsToValidate = enteredContactUs.substring(enteredContactUs.indexOf("//") + 2, enteredContactUs.length);
                }
                else {
                    contactUsToValidate = $contactUs.val();
                }

                 // contact us (
                 if (!$.regexValidate({ regex: $contactUs.attr("val-regex") }, contactUsToValidate)) {
                    $contactUs.govUkInput("invalidState", $contactUs.attr("val-regex-message"));
                    var contactUsErrorHashLinks = $contactUs.govUkInput("getErrorHashLinks");
                    $errorSummary.govUkErrorSummary("add", contactUsErrorHashLinks);
                    $errorSummary.govUkErrorSummary("show");
                    validStates.push(false);
                } else if (
                    !$.maxLengthValidate({ max: $contactUs.attr("val-max-length") }, contactUsToValidate)) {
                    $contactUs.govUkInput("invalidState", $contactUs.attr("val-max-length-message"));
                    var contactUsErrorHashLinks = $contactUs.govUkInput("getErrorHashLinks");
                    $errorSummary.govUkErrorSummary("add", contactUsErrorHashLinks);
                    $errorSummary.govUkErrorSummary("show");
                    validStates.push(false);
                } else {
                    $contactUs.govUkInput("validState");
                    $errorSummary.govUkErrorSummary("removeErrorHashLinksFor", $contactUs[0].id);
                    $errorSummary.govUkErrorSummary("hideIfEmpty")
                    validStates.push(true);
                }

                // telephone
                if (!$.requiredValidate($telephone.val())) {
                    $telephone.govUkInput("invalidState", $telephone.attr("val-required-message"));
                     var telephoneErrorHashLinks = $telephone.govUkInput("getErrorHashLinks");
                    $errorSummary.govUkErrorSummary("add", telephoneErrorHashLinks);
                    $errorSummary.govUkErrorSummary("show");
                    validStates.push(false);
                } else if (
                    !$.regexValidate({ regex: $telephone.attr("val-regex") }, $telephone.val())) {
                    $telephone.govUkInput("invalidState", $telephone.attr("val-regex-message"));
                     var telephoneErrorHashLinks = $telephone.govUkInput("getErrorHashLinks");
                    $errorSummary.govUkErrorSummary("add", telephoneErrorHashLinks);
                    $errorSummary.govUkErrorSummary("show");
                    validStates.push(false);
                } else if (
                    !$.minLengthValidate({ min: $telephone.attr("val-min-length") }, $telephone.val())) {
                    $telephone.govUkInput("invalidState", $telephone.attr("val-min-length-message"));
                    var telephoneErrorHashLinks = $telephone.govUkInput("getErrorHashLinks");
                    $errorSummary.govUkErrorSummary("add", telephoneErrorHashLinks);
                    $errorSummary.govUkErrorSummary("show");
                    validStates.push(false);
                } else if (
                    !$.maxLengthValidate({ max: $telephone.attr("val-max-length") }, $telephone.val())) {
                    $telephone.govUkInput("invalidState", $telephone.attr("val-max-length-message"));
                     var telephoneErrorHashLinks = $telephone.govUkInput("getErrorHashLinks");
                    $errorSummary.govUkErrorSummary("add", telephoneErrorHashLinks);
                    $errorSummary.govUkErrorSummary("show");
                    validStates.push(false);
                } else {
                    $telephone.govUkInput("validState");
                    $errorSummary.govUkErrorSummary("removeErrorHashLinksFor", $telephone[0].id);
                    $errorSummary.govUkErrorSummary("hideIfEmpty")
                    validStates.push(true);
                }

                 if (!validStates.every(isAllValid)) {
                    $("html, body").animate({
                        scrollTop: $errorSummary.offset().top
                    }, 600);
                    $errorSummary.focus();
                }
            };





            $continueButton.on("click", function (event) {
                event.preventDefault();
                validate();
                if (validStates.every(isAllValid)) {
                    $("#ApprenticeshipDetailsForm").submit();
                }
            });


        });
    })(jQuery);
    </script>
